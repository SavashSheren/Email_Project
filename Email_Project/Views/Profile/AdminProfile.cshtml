@model Email_Project.Entities.AppUser
@{
    ViewData["Title"] = "AdminProfile";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style>
    .profile-shell {
        padding: 22px 0;
    }

    .glass-card {
        background: #fff;
        border: 1px solid rgba(0,0,0,.06);
        border-radius: 18px;
        box-shadow: 0 10px 30px rgba(0,0,0,.06);
    }

    .soft-muted {
        color: #6b7280;
    }

    .chip {
        border: 1px solid rgba(0,0,0,.08);
        background: #f8fafc;
        border-radius: 999px;
        padding: 6px 10px;
        font-size: 12px;
        color: #334155;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

    /* Header */
    .profile-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 18px;
        padding: 18px;
    }

    .ph-left {
        display: flex;
        align-items: center;
        gap: 16px;
        min-width: 360px;
    }

    .avatar {
        width: 78px;
        height: 78px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #fff;
        box-shadow: 0 8px 22px rgba(0,0,0,.10);
        background: #f1f5f9;
    }

    .ph-name {
        font-size: 20px;
        font-weight: 800;
        margin: 0;
        color: #111827;
    }

    .ph-role {
        margin: 2px 0 0;
        font-size: 13px;
        color: #6b7280;
    }

    .ph-actions {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }

    .btn-soft {
        border: 1px solid rgba(0,0,0,.10);
        background: #fff;
        border-radius: 10px;
        padding: 8px 12px;
        font-weight: 700;
        text-decoration: none;
        color: #111827;
    }

    .btn-primary2 {
        background: #6D28D9;
        border: none;
        color: #fff;
        border-radius: 10px;
        padding: 8px 12px;
        font-weight: 800;
        text-decoration: none;
    }

        .btn-primary2:hover {
            opacity: .95;
            color: #fff;
        }

    .ph-right {
        display: grid;
        grid-template-columns: 160px 220px;
        gap: 10px 22px;
        align-content: center;
    }

    .kv {
        display: flex;
        gap: 8px;
        align-items: center;
        font-size: 13px;
    }

        .kv b {
            width: 86px;
            color: #111827;
            font-weight: 800;
        }

        .kv span {
            color: #6b7280;
        }

    /* Tabs */
    .tabs-bar {
        display: flex;
        gap: 10px;
        padding: 12px 18px 18px;
        border-top: 1px solid rgba(0,0,0,.06);
    }

    .tab-pill {
        border-radius: 999px;
        padding: 8px 12px;
        font-weight: 800;
        font-size: 12px;
        border: 1px solid rgba(0,0,0,.08);
        background: #fff;
        color: #111827;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

        .tab-pill.active {
            background: #6D28D9;
            border-color: #6D28D9;
            color: #fff;
        }

    /* KPI */
    .kpi-grid {
        display: grid;
        grid-template-columns: repeat(4,1fr);
        gap: 14px;
        margin-top: 14px;
    }

    .kpi {
        border-radius: 16px;
        color: #fff;
        padding: 14px;
        position: relative;
        overflow: hidden;
        box-shadow: 0 12px 26px rgba(0,0,0,.10);
        min-height: 92px;
    }

    .kpi-title {
        font-size: 12px;
        opacity: .9;
        font-weight: 800;
    }

    .kpi-value {
        font-size: 28px;
        font-weight: 900;
        margin-top: 4px;
    }

    .kpi-sub {
        font-size: 12px;
        opacity: .9;
        margin-top: 6px;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .kpi-ico {
        position: absolute;
        right: 12px;
        top: 12px;
        width: 40px;
        height: 40px;
        border-radius: 14px;
        background: rgba(255,255,255,.18);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
    }

    .bg1 {
        background: linear-gradient(135deg,#7C3AED,#4F46E5);
    }

    .bg2 {
        background: linear-gradient(135deg,#2563EB,#06B6D4);
    }

    .bg3 {
        background: linear-gradient(135deg,#F43F5E,#FB7185);
    }

    .bg4 {
        background: linear-gradient(135deg,#F59E0B,#F97316);
    }

    /* Blocks */
    .block-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 14px 16px;
        border-bottom: 1px solid rgba(0,0,0,.06);
    }

        .block-head h6 {
            margin: 0;
            font-weight: 900;
            color: #111827;
            font-size: 16px;
        }

    .dotmenu {
        color: #111827;
        opacity: .6;
        font-size: 22px;
    }

    
    .topcat-item {
        margin-bottom: 18px;
    }

    .topcat-label {
        display: flex;
        justify-content: space-between;
        font-weight: 800;
        font-size: 13px;
        margin-bottom: 8px;
        color: #111827; 
    }

    .topcat-rail {
        height: 12px;
        border-radius: 999px;
        background: #E9EEF5;
        overflow: hidden;
    }

    .topcat-bar {
        height: 12px;
        border-radius: 999px;
        box-shadow: 0 6px 14px rgba(0,0,0,.10);
    }

    .bar-blue {
        background: #1671FF;
    }

    .bar-green {
        background: #0F7A45;
    }

    .bar-yellow {
        background: #F4B400;
    }

    .bar-red {
        background: #E11D48;
    }

    @@media (max-width:1200px) {
        .kpi-grid {
            grid-template-columns: repeat(2,1fr);
        }

        .ph-right {
            grid-template-columns: 1fr;
        }

        .ph-left {
            min-width: auto;
        }

        .profile-header {
            flex-direction: column;
            align-items: flex-start;
        }
    }
</style>

@{
    var avatarUrl = "/images/default-avatar.png";
    if (!string.IsNullOrWhiteSpace(Model?.ImageUrl))
    {
        avatarUrl = "/images/" + Model.ImageUrl;
    }
}

<div class="container-fluid profile-shell">

    <!-- TOP HEADER -->
    <div class="glass-card">
        <div class="profile-header">
            <div class="ph-left">
                <img class="avatar" src="@avatarUrl" alt="avatar" />
                <div>
                    <p class="ph-name">@Model?.Name @Model?.Surname</p>
                    <p class="ph-role">
                        Admin Panel
                        <span class="ms-2 chip"><i class='bx bx-envelope'></i>@Model?.Email</span>
                    </p>

                    <div class="ph-actions">
                        <a class="btn-primary2" href="/Profile/Index"><i class='bx bx-edit-alt me-1'></i>Edit Profile</a>
                        <a class="btn-soft" href="/Message/CreateMessage"><i class='bx bx-mail-send me-1'></i>New Message</a>
                    </div>
                </div>
            </div>

            <div class="ph-right">
                <div class="kv"><b>UserName</b><span>@Model?.UserName</span></div>
                <div class="kv"><b>Status</b><span>Active</span></div>

                <div class="kv"><b>Incoming</b><span>@(ViewBag.IncomingCount ?? 0)</span></div>
                <div class="kv"><b>Outgoing</b><span>@(ViewBag.OutgoingCount ?? 0)</span></div>

                <div class="kv"><b>Unread</b><span>@(ViewBag.UnreadCount ?? 0)</span></div>
                <div class="kv"><b>Top Contact</b><span>@(ViewBag.TopContact ?? "—")</span></div>
            </div>
        </div>

        <div class="tabs-bar">
            <a class="tab-pill active" href="#"><i class='bx bx-dashboard'></i>Overview</a>
            <a class="tab-pill" href="/Message/Inbox"><i class='bx bx-inbox'></i>Inbox</a>
            <a class="tab-pill" href="/Profile/Index"><i class='bx bx-cog'></i>Edit Profile</a>
        </div>
    </div>

    <!-- KPI ROW -->
    <div class="kpi-grid">
        <div class="kpi bg1">
            <div class="kpi-ico"><i class='bx bx-inbox'></i></div>
            <div class="kpi-title">Monthly Received</div>
            <div class="kpi-value">@((ViewBag.IncomingCount ?? 0))</div>
            <div class="kpi-sub"><i class='bx bx-calendar'></i>This month</div>
        </div>

        <div class="kpi bg2">
            <div class="kpi-ico"><i class='bx bx-send'></i></div>
            <div class="kpi-title">Monthly Sent</div>
            <div class="kpi-value">@((ViewBag.OutgoingCount ?? 0))</div>
            <div class="kpi-sub"><i class='bx bx-calendar'></i>This month</div>
        </div>

        <div class="kpi bg3">
            <div class="kpi-ico"><i class='bx bx-message-rounded-error'></i></div>
            <div class="kpi-title">Unread Messages</div>
            <div class="kpi-value">@((ViewBag.UnreadCount ?? 0))</div>
            <div class="kpi-sub"><i class='bx bx-bell'></i>@(ViewBag.UnreadInfo ?? "—")</div>
        </div>

        <div class="kpi bg4">
            <div class="kpi-ico"><i class='bx bx-pie-chart-alt-2'></i></div>
            <div class="kpi-title">Top Category</div>
            <div class="kpi-value" style="font-size:18px; margin-top:10px;">@(ViewBag.TopCategory ?? "—")</div>
            <div class="kpi-sub"><i class='bx bx-layer'></i>Most used</div>
        </div>
    </div>

    <!-- TRAFFIC (LEFT, BIG) + TOP CATEGORIES (RIGHT) ✅ like screenshot -->
    <div class="row mt-3 g-3">

        <!-- LEFT: Messaging Traffic -->
        <div class="col-lg-8">
            <div class="glass-card h-100">
                <div class="block-head" style="border-bottom:0;">
                    <h6>Messaging Traffic</h6>

                    <div class="btn-group btn-group-sm" role="group" aria-label="Traffic range">
                        <button type="button" class="btn btn-outline-secondary" id="btnDaily">Daily</button>
                        <button type="button" class="btn btn-outline-secondary" id="btnWeekly">Weekly</button>
                        <button type="button" class="btn btn-outline-secondary active" id="btnMonthly">Monthly</button>
                    </div>
                </div>

                <div class="p-3">
                    <div style="height:340px;">
                        <canvas id="trafficChart"></canvas>
                    </div>
                    <div class="soft-muted mt-2" style="font-size:12px;">
                        Tracks your received and sent messages over time.
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT: Top Categories -->
        <div class="col-lg-4">
            <div class="glass-card h-100">
                <div class="block-head">
                    <h6>Top Categories</h6>
                    <span class="dotmenu">•••</span>
                </div>

                <div class="p-3">
                    @{
                        // Colors exactly like your screenshot order
                        string[] colorClasses = { "bar-blue", "bar-green", "bar-yellow", "bar-red" };
                        int idx = 0;
                    }

                    @if (ViewBag.TopCategories != null)
                    {
                        foreach (var cat in ViewBag.TopCategories)
                        {
                            var cls = colorClasses[Math.Min(idx, 3)];
                            idx++;

                            <div class="topcat-item">
                                <div class="topcat-label">
                                    <span>@cat.Name</span>
                                    <span class="soft-muted">@cat.Percentage%</span>
                                </div>

                                <div class="topcat-rail">
                                    <div class="topcat-bar @cls" style="width:@cat.Percentage%"></div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="soft-muted">No category data available.</div>
                    }

                    <div class="mt-3" style="font-size:12px; color:#6b7280;">
                        <b style="color:#111827;">Top Contact:</b> @(ViewBag.TopContact ?? "—")
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>

@section Scripts {
    <style>
     
        #action-bar {
            display: none !important;
        }
    </style>

   
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        const trafficDaily = @Html.Raw(ViewBag.TrafficDaily ?? "null");
        const trafficWeekly = @Html.Raw(ViewBag.TrafficWeekly ?? "null");
        const trafficMonthly = @Html.Raw(ViewBag.TrafficMonthly ?? "null");

        const safe = (x) => x ?? { labels: [], received: [], sent: [] };
        let current = safe(trafficMonthly);

        const canvas = document.getElementById('trafficChart');
        const chart = canvas ? new Chart(canvas, {
            type: 'line',
            data: {
                labels: current.labels,
                datasets: [
                    { label: 'Received', data: current.received, tension: 0.35, fill: true },
                    { label: 'Sent', data: current.sent, tension: 0.35, fill: true }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true },
                    tooltip: { mode: 'index', intersect: false }
                },
                interaction: { mode: 'index', intersect: false },
                scales: {
                    x: { grid: { display: false } },
                    y: { beginAtZero: true }
                }
            }
        }) : null;

        function setActive(btnId) {
            document.getElementById('btnDaily')?.classList.remove('active');
            document.getElementById('btnWeekly')?.classList.remove('active');
            document.getElementById('btnMonthly')?.classList.remove('active');
            document.getElementById(btnId)?.classList.add('active');
        }

        function updateChart(payload) {
            if (!chart) return;
            const p = safe(payload);
            chart.data.labels = p.labels;
            chart.data.datasets[0].data = p.received;
            chart.data.datasets[1].data = p.sent;
            chart.update();
        }

        document.getElementById('btnDaily')?.addEventListener('click', () => {
            setActive('btnDaily');
            updateChart(trafficDaily);
        });

        document.getElementById('btnWeekly')?.addEventListener('click', () => {
            setActive('btnWeekly');
            updateChart(trafficWeekly);
        });

        document.getElementById('btnMonthly')?.addEventListener('click', () => {
            setActive('btnMonthly');
            updateChart(trafficMonthly);
        });
    </script>
}
